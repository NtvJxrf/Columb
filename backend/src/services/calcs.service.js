import ballons from './calculators/ballons.calulator.js'
import fbort from './calculators/fbort.calculator.js'
import mattress from './calculators/mattress.calculator.js'
import axios from 'axios'
import Users from '../databases/models/user/user.model.js'
import HistoryNote from '../databases/models/user/HistoryNote.model.js'
import historyNoteValidator from '../validators/historyNote. validator.js'
const tempSelfcost = {
    'ткань 850г/м2': 380,
    'ткань 1100г/м2': 500,
    'ткань 650г/м2': 253,
    'ткань 750г/м2': 350,
    'ткань тентовая 650г/м2': 250,
    'переходник': 32,
    'клапан': 120,
    'законцовки усеченные': 69,
    'люверсы оцинков.12мм': 5,
    'люверсная лента 1м.': 115,
    'защита баллона доп.слоем ткани шир.40см': 236,
    'защита баллона доп.слоем ткани шир.40см ткань 750г': 250,
    'защита баллона доп.слоем ткани шир.30см ткань 750г': 185,
    'защита баллона рафтовой лентой 23см': 126,
    'ткань 400г/м2': 250,
    'клей, кг': 1200,
    'отвердитель, л': 1500,
    'ацетон, л': 175,
    'скотч, рулон': 90,
    'кисть, шт': 22,
    'баночки для клея, шт': 18,
    'насос 5 литров ножной': 400,
    'полукольцо сварное': 15,
    'шнур пвх 7мм': 15,
    'Шайба леера №1': 18,
    'рым с полукольцом': 26,
    'ликпаз малый': 11,
    'ликпаз большой': 14,
    'привал 12см': 67,
    'привал 9см': 82,
    'привал 6см': 50,
    'привальный брус с брызгоотбойником': 62,
    'шайба леера №1': 11,
    'пленка пвх 500 мкм': 150,
    'Трубка прозрачная из пвх 16мм': 48,
    'рым с большим полукольцом': 90,
    'леер': 24,
    'ручка переноса': 36,
    'уключина': 125,
    'законцовка круглая': 30,
    'весло 160см': 339,
    'весло 180см': 281,
    'весло 200см': 510,
    'держатель весла': 11,
    'якорный рым Голубева': 177,
    'якорный рым-утка': 700,
    'привальный брус 6см, м': 46,
    'усиление лентой 12см,м': 67,
    'рафтовая лента 9мм, м': 64,
    'транцедержатель 18мм': 88,
    'транцедержатель 21мм': 70,
    'транцедержатель 27мм': 135,
    'транцедержатель 35мм': 133,
    'крепление банки большое': 14,
    'крепление банки малое для упора пола': 11,
    'Шнур ПВХ 7 мм (300 м.п)': 14,
    'транцедержатель 25мм': 135,
    'ключ': 37,
    'штуцер для баллонов катамарана': 200,
    'весло байдарчное 200см': 480,
    'клапан стравливающий': 99,
    'навесной транец': 350,
    'ткань Оксфорд 600D': 190,
    'ткань 750 камуфляж': 335,
    'ТПУ 1мм, черный': 1490,
    'ткань пвх 1200, ширина 1,55м': 650,
    'клапан браво': 360,
    'клапан 210': 120,
    'рым под трубу 22мм Баджер (навесного транца)': 100,
    'рым с 2 полукольцами': 60,
    'пленка пвх 500мк, м2': 180,
    'бутылка 70мл/100мл с крышкой': 7,
    'бутылка 500мл с крышкой': 8,
    'ТПУ 1мм, прозрачный, м2': 1100,
    'ткань газодер 650г/м2 огнестойкий, мороз -50, ширина рулона 2,7м': 368,
    'ткань 850г/м2 огнестойкий, мороз -50, ширина рулона 2,7м': '',
    'ткань тентов 900г/м2 морозост/огнест  белая до -50, шир.3метра\n': 460,
    'Труба 40*1,5 Д16Т, м': 1400,
    'Труба 36*2,0 Д16Т, м': 1600,
    'Труба 45*2,0, Д16Т, м': 1900,
    'заглушки для трубы 40': 10,
    'Болт 6*100 с шайбами, шт': 15,
    'пряжка 3-х щелевая для закрышки': 7,
    'люверсы': 5,
    'заклепки': 5,
    'люверс 10 мм': 1.25,
    'шнуровка для палубы': 80,
    'Труба 22х1,5 алюм.': 200,
    'клей пва, 1 кг': 200,
    'труба 18*1,5 алюм': 120,
    'труба 22*1,5 алюм': 200,
    'пряжка 2-х щел 30мм': 5,
    'пряжка 3-х щел усил 30мм': 10.64,
    'молния 10, м': 16,
    'бегунок, шт': 15,
    'Стропа 40, м': 8.7,
    'нитки, м': 0.45,
    'ручка сумочная плоская 25мм': 20,
    'фастекс 30 апри': 33,
    'фастекс 20 топтрейд': 7.5,
    'фастекс 40': 29,
    'тесьма 22мм': 3.6,
    'стропа 20': 5,
    'шнур 4,5мм полиэф': 0.89,
    'шнур 5мм с сердеч': 1.77,
    'стропа 30 усилен': 14.5,
    'Пряжка трехщ усил 25мм, LS': 14,
    'стропа 30 14г OS': 7.1,
    'стропа 25 14гр OS': 6.5,
    'фастекс 25 топтрейд': 12,
    'пряжка двухщелев 40мм': 4.3,
    'стропа 25 мм усилен': 12,
    'стропа 25 мм 11г для сумок': 4.77,
    'крючок тентовый': 5,
    'опора для тента': 14,
    'наконечник для тента': 8.5,
    'люверс 5': 1,
    'Резинка шляпная 6мм': 22,
    'подвеска на замок (пулер)': 3,
    'Карабин 40мм*2,8мм (никель)': 8,
    'кант (кедер)': 2,
    'трубка термо d6, м': 70,
    'поролон 1,5м*2м*5см, м2': 700,
    'этикетка+веревочка+прозрачный пакет+курьер пакет': 24.6,
    'этикетка 2шт на сумку на ликтрос(лого+бумажн)': 15.100000000000001,
    'веревочка для этикетки': 0.37,
    'прозрачный пакет для сумки на ликтрос зиплок 35*45': 5.33,
    'курьер пакет 43*35': 3.8,
    'ткань для жилета, м2': 53,
    'подклад для жилета (Ткань Оксфорд 200D SH PU1000, 95гр), м2': 50,
    'светоотражающая лента 2,5см, м.п': 4,
    'свисток': 10,
    'логотип тканевый': 20,
    'пенополиэтилен 10 мм, м2': 70,
    'фастекс 30 топтрейд': 15,
    'эва, м2': 730,
    'наклейка на ремкомплект': 9.5,
    'наклейка на клей ': 6.5,
    'Расход клея на 1 м2, кг': 0.18,
    'Бегунок №7 реверсивный д/спиральной молнии S-580(322)': 5,
    'Кант атласный S-580 черный (65,8м/уп)': 4.5,
    'Велькро (липучка) 20мм черная, S-580 типА': 25,
    'Шнур для одежды круглый черный 5мм 5-02': 2,
    'сетка рюкзачная трикотажная, черная 2020-09-01,120г/м2 шир 150см': 100,
    'Резинка шляпная 4мм черный, 100м арт черА/РШ4,0': 9,
    'Стопор для шнура': 3,
    'наконечник крокодил NY': 1,
    'стропа черная светоотражающая 20/7 СВ': 8,
    'полукольцо пласт. 30мм Н2021': 3,
    'полукольцо пласт. 20мм Н2006': 1.3,
    'полукольцо пласт. 25мм Н2006': 2,
    'полукольцо пласт. 40мм Н2006': 3.8,
    'Молния спиральная №7 влагозащитная рулонная S-580 черный/хамелион светоотр. 200м/уп': 40,
    'карабин пласт 30мм G2003': 8.5,
    'резинка 25мм, вязаная OS': 6,
    'карабин пласт 40мм G2003': 8.5,
    'карабин пласт 20мм ': '',
    'карабин пласт 30мм ': 8.5,
    'основание для карабина': '',
    'наплечник 30мм': 4,
    'молния спир.№5': 9,
    'бегунок №5': 5,
    'стропа №10': 4,
    'Застежка роллинг КА 0040 В никель': 25,
    'Изолон 8мм (для рюкзачных лямок)': 485,
    'пряжка 2-х щелевая 25мм': 4,
    'люверс 12': 2.5,
    'паспорт к лодке': 10,
    'логотип резиновый 12*10': 110,
    'логотип резиновый длинный': 150,
    'логотип простой 9*6': 10,
    'ремкомплект': 80,
    'ключ к клапану': 37,
    'нашивка': 44,
    'шильдик': 55,
    'гриппер 150*220': 5.8,
    'логотип резиновый 6,5*4': 30,
    'логотип жаккардовый 70*70': 23,
    'Зиплок 20*30 30мкм': 2,
    'Зиплок 35*45 40мкм': 5,
    'Зиплок 20*25 40мкм': 1.6,
    'Зиплок 30*40 40мкм': 3.4,
    'раскрой, час': 400,
    'сборка, час': 500,
    'обвес, час': 500,
    'Закройщик, цена без налогов, мес': 70000,
    'Сборщик, цена без налогов, мес': 90000,
    'Обвес, цена без налогов, мес': 85000,
    'Продавец, цена c налогами, мес': 75000,
    'Сварщик, цена без налогов, мес': 160000,
    'фанера 9мм, м2': 1200,
    'фанера 12мм': 1300,
    'фанера 15мм': 2200,
    'фанера 18мм': 2200,
    'фанера 21мм': 2300,
    'фанера 24мм': 2400,
    'фанера 27мм': 2900,
    'фанера 35мм': 3500,
    'Винт с круглой головкой М8*60': 9.08,
    'Гайка М8 самоконтрящаяся': 4.15,
    'Рым-гайка М8': 30,
    'стрингер 12мм, 1м с двумя заглушками': 1122,
    'стрингер 9мм, 1м': 580,
    'профиль папа 12мм, м': 326,
    'профиль мама 12мм, м': 326,
    'заклепки для пола': 2.2,
    'профиль папа  9мм, м': 243,
    'профиль мама  9мм, м': 243,
    'газлифт': 80,
    'барашек М8': 7,
    'метиы на столик': 15,
    'фреза': 1000,
    'круг абразивный': 15,
    'шайба М8 увеличен': 2.16,
    'отбортовка для столика': 80,
    'трубка 10 мм, 1м': 200,
    'кронштейн сварной': 1000,
    'саморез': 0.3,
    'Шуруп 3,5*20 потай, желтый цинк': 0.35,
    'саморез ГКЛ-дерево 3,5*16 желтый': 0.35,
    'заклепка вытяжная 3,2*10 ': 1.25,
    'Усиление 1 м.п, ширина 23,5см': 361.63201298701296,
    'Усиление 1 м.п, ширина 12см': 258.127012987013,
    'Усиление 1 м.п, ширина 9см': 261.517012987013,
    'Усиление 1 м.п, ширина 6см': 217.907012987013
  }
export default class CalcsService{
    static selfcost = null
    static calculate(value, type){
        const calculators = {
            ballons: ballons,
            fbort: fbort,
            mattress: mattress
        }
        return calculators[type](value, this.selfcost)
    }
    static async loadData(){
        if(process.env.NODE_ENV === 'development'){
            this.selfcost = tempSelfcost
            return
        }
        const response = await axios.get(process.env.SELFCOSTURL)
        this.selfcost = response.data
    }
    static async createHistoryNote(data){
        await historyNoteValidator.validateAsync({...data, initData: JSON.parse(data.initData)})
        return await HistoryNote.create(data)
    }
    static async getHistoryNotes(type){
        const notes = await HistoryNote.findAll({
            where: { type },
            include: [{
                model: Users,
                as: 'creator',
                attributes: ['username'],
                paranoid: false
            }]
        });
        return notes.map(note => {
            const data = note.toJSON();
            data.creator = note.creator.dataValues.username
            return data;
        });
    }
    static async deleteHistory(id){
        return await HistoryNote.destroy({where: {id}})
    }
    static async updateHistory(data){
        const { id, comments, markup, initData } = data.toChange
        return await HistoryNote.update({comments, markup, initData: JSON.stringify(initData)}, {where: {id}})
    }
}

CalcsService.loadData()